if size_box_long > 0
    for j = 0 to size_box_long - 1        
        check_used = array.get(check_used_long, j)
        if check_used != 0
            box tp = array.get(long_tp_boxes, j)                        
            box sl = array.get(long_sl_boxes, j)    
            price_tp = box.get_top(tp)                    
            price_sl = box.get_bottom(sl)
            price_init = box.get_bottom(tp)
            curIdx_init = box.get_left(tp)
            if curIdx_init != bar_index and price_tp <= high
                cnt_long_tp := cnt_long_tp + 1
                array.set(check_used_long, j, 0)
                res = ((price_tp-price_init)/price_init)*100
                res_tp := res_tp + res
                label.new(box.get_left(tp), price_tp, text = str.format("{0}%", res), textcolor = color.white)
            else if curIdx_init != bar_index and price_sl >= low                                
                array.set(check_used_long, j, 0)
                res = ((price_init-price_sl)/price_init)*100
                res_sl := res_sl + res
                label.new(box.get_left(tp), price_tp, text = str.format("{0}%", res), textcolor = color.white)
            
            box.set_right(tp, bar_index)
            box.set_right(sl, bar_index)

if size_box_short > 0
    for j = 0 to size_box_short - 1        
        check_used = array.get(check_used_short, j)
        if check_used != 0
            box tp = array.get(short_tp_boxes, j)                        
            box sl = array.get(short_sl_boxes, j)    
            price_tp = box.get_bottom(tp)                    
            price_sl = box.get_top(sl)
            curIdx_init = box.get_left(tp)
            price_init = box.get_top(tp)
            if curIdx_init != bar_index and price_sl <= high
                res = ((price_sl-price_init)/price_init)*100
                res_sl := res_sl + res
                label.new(box.get_left(sl), price_sl, text = str.format("{0}%", res), textcolor = color.white)
                array.set(check_used_short, j, 0)
            else if curIdx_init != bar_index and price_tp >= low
                res = ((price_init-price_tp)/price_init)*100
                res_tp := res_tp + res
                cnt_short_tp := cnt_short_tp + 1
                label.new(box.get_left(tp), price_tp, text = str.format("{0}%", res), textcolor = color.white)
                array.set(check_used_short, j, 0)
            
            box.set_right(tp, bar_index)
            box.set_right(sl, bar_index)
